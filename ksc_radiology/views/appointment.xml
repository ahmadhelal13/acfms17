<?xml version='1.0' encoding='utf-8'?>
<odoo>

    <record id="seq_ksc_radiology_appointment" model="ir.sequence">
        <field name="name">KSC Appointment</field>
        <field name="code">ksc.radiology.appointment</field>
        <field name="prefix">APP</field>
        <field name="padding">3</field>
        <field name="company_id" eval="False"/>
    </record>

    <record id="view_ksc_radiology_appointment_search" model="ir.ui.view">
        <field name="name">ksc.radiology.appointment.search</field>
        <field name="model">ksc.radiology.appointment</field>
        <field name="mode">primary</field>
        <field name="priority" eval="8"/>
        <field name="inherit_id" ref="ksc_clinic_base.view_ksc_appointment_search"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="replace">
                <field name="name"/>
            </xpath>
        </field>
    </record>

    <record id="view_ksc_radiology_appointment_tree" model="ir.ui.view">
        <field name="name">ksc.radiology.appointment.tree</field>
        <field name="model">ksc.radiology.appointment</field>
        <field name="mode">primary</field>
        <field name="priority" eval="8"/>
        <field name="inherit_id" ref="ksc_clinic_base.view_ksc_appointment_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="replace">
                <field name="name"/>
            </xpath>
            <xpath expr="//field[@name='invoice_state']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist,ksc_radiology.ksc_radiology_doctor,ksc_radiology.ksc_radiology_nurse</attribute>
            </xpath>

            <xpath expr="//field[@name='has_credit_note']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist,ksc_radiology.ksc_radiology_doctor,ksc_radiology.ksc_radiology_nurse</attribute>
            </xpath>
        </field>
    </record>

    <record id="view_ksc_radiology_appointment_form" model="ir.ui.view">
        <field name="name">ksc.radiology.appointment.form</field>
        <field name="model">ksc.radiology.appointment</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="ksc_clinic_base.view_ksc_appointment_form"/>
        <field name="priority" eval="8"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='appointment_confirm']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist</attribute>
            </xpath>
            <xpath expr="//button[@name='appointment_waiting']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist</attribute>
            </xpath>
            <xpath expr="//button[@name='action_create_evaluation']" position="attributes">
                <attribute name="groups">
                    ksc_radiology.ksc_radiology_nurse
                </attribute>
            </xpath>
            <xpath expr="//button[@name='appointment_consultation']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_doctor,ksc_radiology.ksc_radiology_nurse</attribute>
            </xpath>
            <xpath expr="//button[@name='action_pause']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist</attribute>
            </xpath>
            <!-- <xpath expr="//button[@name='create_services_invoice']" position="attributes">
                <attribute name="groups">
                    ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist
                </attribute>
            </xpath> -->
            <xpath expr="//button[@name='view_list_invoice']" position="attributes">
                <attribute name="groups">
                    ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist
                </attribute>
            </xpath>
            <xpath expr="//button[@name='action_start_paused']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist</attribute>
            </xpath>
            <xpath expr="//button[@name='consultation_done']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_doctor,
                    ksc_radiology.ksc_radiology_receptionist,ksc_radiology.ksc_radiology_nurse</attribute>
            </xpath>
            <xpath expr="//button[@name='appointment_done']" position="attributes">
                <attribute name="groups">
                    ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_doctor,
                    ksc_radiology.ksc_radiology_receptionist,ksc_radiology.ksc_radiology_nurse</attribute>
            </xpath>
            <xpath expr="//button[@name='create_invoice']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist</attribute>
            </xpath>
            <xpath expr="//button[@name='action_open_change_physician']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_receptionist</attribute>
            </xpath>
            <xpath expr="//button[@name='appointment_cancel']" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_doctor,ksc_radiology.ksc_radiology_receptionist,ksc_radiology.ksc_radiology_nurse</attribute>
            </xpath>
            <xpath expr="//button[@name='action_open_prescription']" position="replace"/>
            <xpath expr="//button[@name='action_open_lab_request']" position="replace"/>
            <xpath expr="//button[@name='action_open_radio_request']" position="replace"/>



            <xpath expr="//field[@name='room_id']" position="replace">
                <field name="radio_type_id" options="{'no_create': True}"/>
            </xpath>
            <xpath expr="//field[@name='product_id']" position="attributes">
                <attribute name="invisible">1</attribute>
                <attribute name="domain">[('avalibel_in_radiology','=',True),('clinical_type','=','consultation')]</attribute>
            </xpath>
            <xpath expr="//field[@name='appointment_purpose']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <!-- <xpath expr="//page[@name='advice']" position="replace"/> -->
            <xpath expr="//separator[1]" position="replace">
                <separator string="Conclusion Report"/>
            </xpath>
            <xpath expr="//field[@name='notes']" position="replace">
                <field name="radio_notes" readonly="state == 'done' or not hide_based_on_group or not read_based_on_nurse_group" placeholder="Conclusion Report..."/>
            </xpath>

            <xpath expr="//field[@name='queue_number']" position="after">
                <field name="clinic_name" invisible="1"/>
            </xpath>
            <xpath expr="//page[@name='special_report']" position="replace"/>
            <page name="diseases_ids" position="after">
                <page name="diseases_ids" string="Diseases" invisible="True or (clinic_name != 'radiology')">
                    <field name="diseases_ids" nolabel="1" colspan="4" readonly="state == 'done' or not hide_based_on_group or not read_based_on_nurse_group or not read_based_on_manager_group">                        <tree editable="bottom">
                            <!-- <field name="name" /> -->
                            <field name="disease_id"/>
                        </tree>
                    </field>
                </page>
            </page>
            <page name="medical_report" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_doctor,ksc_radiology.ksc_radiology_receptionist,ksc_radiology.ksc_radiology_nurse</attribute>
            </page>
            <xpath expr="//page[@name='medical_report']//field[@name='medical_report']" position="attributes">
                <attribute name="readonly">state == 'done' or not hide_based_on_group or not read_based_on_nurse_group</attribute>
                <!--TODO: Result from converting 'attrs' attribute override without options for ['invisible', 'required', 'column_invisible'] to separate attributes
                     Remove redundant empty tags below for any of those attributes that are not present in the field tag in any of the parent views
                     If someone later adds one of these attributes in the parent views, they would likely be unaware it's still overridden in this view, resulting in unexpected behaviour, which should be avoided-->
                <!--TODO: Result from 'attrs' -> 'invisible' conversion without also overriding 'states' attribute
                     Check if this field tag contained a states attribute in any of the parent views, that should be combined into this 'invisible' attribute
                     (If any states attributes existed in parent views, they'll also be marked with a TODO)-->
                <attribute name="invisible"/>
                <attribute name="required"/>
                <attribute name="column_invisible"/>
            </xpath>
            <xpath expr="//page[@name='medical_report']//field[@name='work_place']" position="attributes">
                <attribute name="readonly">state == 'done' or not hide_based_on_group or not read_based_on_nurse_group</attribute>
                <!--TODO: Result from converting 'attrs' attribute override without options for ['invisible', 'required', 'column_invisible'] to separate attributes
                     Remove redundant empty tags below for any of those attributes that are not present in the field tag in any of the parent views
                     If someone later adds one of these attributes in the parent views, they would likely be unaware it's still overridden in this view, resulting in unexpected behaviour, which should be avoided-->
                <!--TODO: Result from 'attrs' -> 'invisible' conversion without also overriding 'states' attribute
                     Check if this field tag contained a states attribute in any of the parent views, that should be combined into this 'invisible' attribute
                     (If any states attributes existed in parent views, they'll also be marked with a TODO)-->
                <attribute name="invisible"/>
                <attribute name="required"/>
                <attribute name="column_invisible"/>
            </xpath>
            <page name="diseases_ids" position="replace">
                <page name="test_lines" string="Test Lab Lines">
                    <field name="hide_based_on_group" invisible="1"/>
                    <field name="lines_ids" nolabel="1" colspan="4" options="{'no_create': True}">
                        <tree string="Line" editable="bottom">
                            <field name="test_id" options="{'no_create':true, 'no_create_edit':True}" domain="[('radio_type_id','=',parent.radio_type_id)]" required="1"/>
                            <field name="product_price"/>
                            <field name="notes"/>
                            <field name="test_result" widget="url"/>
                        </tree>
                    </field>
                </page>
            </page>
        </field>
    </record>


    <record id="view_ksc_radiology_appointment_form_popup" model="ir.ui.view">
        <field name="name">ksc.radiology.appointment.form.popup</field>
        <field name="model">ksc.radiology.appointment</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="ksc_clinic_base.view_ksc_appointment_form"/>
        <field name="priority" eval="8"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='patient_id']" position="attributes">
                <attribute name="readonly">1</attribute>
                <attribute name="options">{'no_open':true}</attribute>
            </xpath>
            <xpath expr="//field[@name='physician_id']" position="attributes">
                <attribute name="readonly">1</attribute>
                <attribute name="options">{'no_open':true}</attribute>
            </xpath>
            <xpath expr="//field[@name='start_date']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='end_date']" position="replace"/>
            <xpath expr="//field[@name='product_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='appointment_purpose']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='state']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='room_id']" position="replace">
                <field name="radio_type_id" options="{'no_create': True}"/>
            </xpath>
            <xpath expr="//button[@name='appointment_confirm']" position="replace"/>
            <xpath expr="//button[@name='appointment_waiting']" position="replace"/>
            <xpath expr="//button[@name='appointment_consultation']" position="replace"/>
            <xpath expr="//button[@name='action_pause']" position="replace"/>
            <xpath expr="//button[@name='action_start_paused']" position="replace"/>
            <xpath expr="//button[@name='consultation_done']" position="replace"/>
            <xpath expr="//button[@name='create_invoice']" position="replace"/>
            <xpath expr="//button[@name='action_open_change_physician']" position="replace"/>
            <!-- <xpath expr="//button[@name='action_open_prescription']" position="replace"/> -->
            <xpath expr="//button[@name='view_list_invoice']" position="replace"/>
            <xpath expr="//button[@name='action_create_evaluation']" position="replace"/>
            <page name="advice" position="attributes">
                <attribute name="groups">ksc_radiology.ksc_radiology_manager,ksc_radiology.ksc_radiology_doctor,ksc_radiology.ksc_radiology_receptionist,ksc_radiology.ksc_radiology_nurse</attribute>
            </page>
            <xpath expr="//page[@name='advice']//field[@name='differencial_diagnosis']" position="attributes">
                <attribute name="readonly">not hide_based_on_group or not read_based_on_nurse_group</attribute>
                <!--TODO: Result from converting 'attrs' attribute override without options for ['invisible', 'required', 'column_invisible'] to separate attributes
                     Remove redundant empty tags below for any of those attributes that are not present in the field tag in any of the parent views
                     If someone later adds one of these attributes in the parent views, they would likely be unaware it's still overridden in this view, resulting in unexpected behaviour, which should be avoided-->
                <!--TODO: Result from 'attrs' -> 'invisible' conversion without also overriding 'states' attribute
                     Check if this field tag contained a states attribute in any of the parent views, that should be combined into this 'invisible' attribute
                     (If any states attributes existed in parent views, they'll also be marked with a TODO)-->
                <attribute name="invisible"/>
                <attribute name="required"/>
                <attribute name="column_invisible"/>
            </xpath>
            <xpath expr="//page[@name='advice']//field[@name='medical_advice']" position="attributes">
                <attribute name="readonly">not hide_based_on_group or not read_based_on_nurse_group</attribute>
                <!--TODO: Result from converting 'attrs' attribute override without options for ['invisible', 'required', 'column_invisible'] to separate attributes
                     Remove redundant empty tags below for any of those attributes that are not present in the field tag in any of the parent views
                     If someone later adds one of these attributes in the parent views, they would likely be unaware it's still overridden in this view, resulting in unexpected behaviour, which should be avoided-->
                <!--TODO: Result from 'attrs' -> 'invisible' conversion without also overriding 'states' attribute
                     Check if this field tag contained a states attribute in any of the parent views, that should be combined into this 'invisible' attribute
                     (If any states attributes existed in parent views, they'll also be marked with a TODO)-->
                <attribute name="invisible"/>
                <attribute name="required"/>
                <attribute name="column_invisible"/>
            </xpath>

            <!-- <xpath expr="//button[@name='action_open_radio_request']" position="replace"/> -->
            <!-- <xpath expr="//button[@name='action_open_lab_request']" position="replace"/> -->
            <!-- <xpath expr="//button[@name='create_services_invoice']" position="replace" /> -->
            <!-- <xpath expr="//button[@name='view_services_invoice']" position="replace" /> -->
            <xpath expr="//button[@name='appointment_cancel']" position="replace"/>
            <page name="diseases_ids" position="replace">
                <page name="test_lines" string="Test Lab Lines">
                    <field name="lines_ids" nolabel="1" colspan="4">
                        <tree string="Line" editable="bottom">
                            <field name="test_id" domain="[('radio_type_id','=',parent.radio_type_id)]" required="1" options="{'no_create': True}"/>
                            <field name="product_price" invisible="1"/>
                            <field name="notes"/>
                            <field name="test_result" widget="url" readonly="1"/>
                        </tree>
                    </field>
                </page>
            </page>
        </field>
    </record>


    <record id="view_ksc_radiology_appointment_calendar" model="ir.ui.view">
        <field name="name">ksc.radiology.appointment.calendar</field>
        <field name="model">ksc.radiology.appointment</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="ksc_clinic_base.view_ksc_appointment_calendar"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="replace">
                <field name="name"/>
            </xpath>
        </field>
    </record>

    <!--    count of radio test-->
    <record id="view_partner_form" model="ir.ui.view">
        <field name="name">Patient Prescription</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <div name="button_box" position="inside">
                <button name="action_view_radio_test" class="oe_stat_button" icon="fa-th-list" type="object" invisible="not is_patient">
                    <div class="o_stat_info">
                        <field name="radio_test_count" class="o_stat_value"/>
                        <span class="o_stat_text">Radio Test</span>
                    </div>
                </button>
            </div>
        </field>
    </record>

    <record id="action_ksc_radiology_consultation" model="ir.actions.act_window">
        <field name="name">Radio Lab Request</field>
        <field name="res_model">ksc.radiology.appointment</field>
        <field name="view_mode">tree,calendar,kanban,form</field>
        <field name="context">{'search_default_today': 1,'search_default_not_done': 1,
            'column':'room_id',
            'force_filters':{
            'fieldName': 'state',
            'filters': [
                {
                    'color_index': 1,
                    'value': 'draft',
                    'label': 'Draft',
                },
                {
                    'color_index': 2,
                    'value': 'confirm',
                    'label': 'Confirm',
                },
                {
                    'color_index': 3,
                    'value': 'waiting',
                    'label': 'Waiting',
                },
                {
                    'color_index': 4,
                    'value': 'in_consultation',
                    'label': 'In Consultation',
                },
                {
                    'color_index': 5,
                    'value': 'pause',
                    'label': 'Pause',
                },
                {
                    'color_index': 6,
                    'value': 'to_invoice',
                    'label': 'To Invoice',
                },
                {
                    'color_index': 7,
                    'value': 'done',
                    'label': 'Done',
                },
                {
                    'color_index': 8,
                    'value': 'cancel',
                    'label': 'Cancel',
                },
            ]
        }}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Record Found
            </p>
            <p>
                Click to add a Consultation
            </p>
        </field>
    </record>

    <record id="action_ksc_radiology_appointment" model="ir.actions.act_window">
        <field name="name">Appointment</field>
        <field name="res_model">ksc.radiology.appointment</field>
        <field name="view_mode">tree,kanban,form,activity</field>
        <field name="domain">[('follow_up','=',False)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Record Found
            </p>
            <p>
                Click to add a Appointment
            </p>
        </field>
    </record>

    <record id="action_ksc_radiology_follow_up" model="ir.actions.act_window">
        <field name="name">Follow Up</field>
        <field name="res_model">ksc.radiology.appointment</field>
        <field name="view_mode">calendar,tree,kanban,form,activity</field>
        <field name="domain">[('follow_up','=',True)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Record Found
            </p>
            <p>
                Click to add a follow up
            </p>
        </field>
    </record>


    <record id="action_account_payments" model="ir.actions.act_window">
        <field name="name">Payments</field>
        <field name="res_model">account.payment</field>
        <field name="view_mode">tree,kanban,form,graph</field>
        <field name="context">{
            'default_payment_type': 'inbound',
            'default_partner_type': 'customer',
            'search_default_inbound_filter': 1,
            'default_move_journal_types': ('bank', 'cash'),
            'radiology':1,
            }
        </field>
        <field name="view_id" ref="account.view_account_payment_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Register a payment
            </p>
            <p>
                Payments are used to register liquidity movements. You can process those payments by your own means or
                by using installed facilities.
            </p>
        </field>
    </record>

    <!--print_report method is called from server action-->
    <record id="action_radiology_report_payments" model="ir.actions.server">
        <field name="name">Sale Report</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_ksc_radiology_appointment"/>
        <field name="state">code</field>
        <field name="code">
            action = model.print_report()
        </field>
    </record>


</odoo>